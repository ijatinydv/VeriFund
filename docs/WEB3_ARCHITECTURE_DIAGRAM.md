# Web3 Integration Architecture Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           VERIFUND WEB3 INTEGRATION                             â”‚
â”‚                         Automatic Smart Contract Deployment                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: FRONTEND (React + Vite)                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ HTTP POST /api/investments/:projectId
                                      â”‚ { amount: 50000 }
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 2: BACKEND API (Express + Node.js)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ investment.controller.js                                                 â”‚  â”‚
â”‚  â”‚  - Validates request                                                     â”‚  â”‚
â”‚  â”‚  - Extracts investorId from JWT token                                   â”‚  â”‚
â”‚  â”‚  - Calls investment.service.createInvestment()                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ investment.service.js                                                    â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  1. Validate investment amount                                          â”‚  â”‚
â”‚  â”‚  2. Find project by ID                                                  â”‚  â”‚
â”‚  â”‚  3. Check project status == 'Funding'                                   â”‚  â”‚
â”‚  â”‚  4. Create Investment record                                            â”‚  â”‚
â”‚  â”‚  5. Update project.currentFundingInr += amount                          â”‚  â”‚
â”‚  â”‚  6. Update project.investorCount += 1                                   â”‚  â”‚
â”‚  â”‚  7. Save project                                                        â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ CRITICAL DECISION POINT                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  if (currentFundingInr >= fundingGoalInr &&                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚      !splitterContractAddress) {                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    ğŸš€ TRIGGER DEPLOYMENT ğŸš€                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  }                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                      â”‚                                   â”‚  â”‚
â”‚  â”‚                                      â–¼                                   â”‚  â”‚
â”‚  â”‚  8. Fetch all investments for project (populated with investor data)    â”‚  â”‚
â”‚  â”‚  9. Populate project.creator with wallet address                        â”‚  â”‚
â”‚  â”‚  10. Call web3Service.deploySplitterContract(project, investments)      â”‚  â”‚
â”‚  â”‚  11. Update project.splitterContractAddress = contractAddress           â”‚  â”‚
â”‚  â”‚  12. Update project.status = 'Live'                                     â”‚  â”‚
â”‚  â”‚  13. Return success with deployed contract address                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ web3.service.js                                                          â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  deploySplitterContract(project, investments):                          â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 1: Validate Inputs                                                â”‚  â”‚
â”‚  â”‚    âœ“ project.creator.walletAddress exists                               â”‚  â”‚
â”‚  â”‚    âœ“ investments.length > 0                                             â”‚  â”‚
â”‚  â”‚    âœ“ All investors have valid walletAddress                             â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 2: Prepare Constructor Arguments                                  â”‚  â”‚
â”‚  â”‚    - initialOwner = project.creator.walletAddress                       â”‚  â”‚
â”‚  â”‚    - Group investments by unique investor addresses                     â”‚  â”‚
â”‚  â”‚    - Calculate share percentages in basis points (10000 = 100%)         â”‚  â”‚
â”‚  â”‚    - Adjust largest share to ensure sum = exactly 10000                 â”‚  â”‚
â”‚  â”‚    - Convert funding goal to ETH repayment cap (120% * goal / rate)     â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 3: Build Hardhat Command                                          â”‚  â”‚
â”‚  â”‚    cd ../contracts &&                                                   â”‚  â”‚
â”‚  â”‚    npx hardhat run scripts/deploy.js --network sepolia                  â”‚  â”‚
â”‚  â”‚      --owner 0x...                                                      â”‚  â”‚
â”‚  â”‚      --payees 0x...,0x...,0x...                                         â”‚  â”‚
â”‚  â”‚      --shares 5000,3000,2000                                            â”‚  â”‚
â”‚  â”‚      --cap 0.6                                                          â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 4: Execute Deployment                                             â”‚  â”‚
â”‚  â”‚    - Spawn child process with 120s timeout                              â”‚  â”‚
â”‚  â”‚    - Capture stdout (contract address)                                  â”‚  â”‚
â”‚  â”‚    - Capture stderr (warnings/errors)                                   â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 5: Validate & Return                                              â”‚  â”‚
â”‚  â”‚    - Parse contract address from stdout                                 â”‚  â”‚
â”‚  â”‚    - Validate with ethers.isAddress()                                   â”‚  â”‚
â”‚  â”‚    - Return address or throw error                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ child_process.exec()
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 3: HARDHAT ENVIRONMENT (Solidity + Ethers.js)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ contracts/scripts/deploy.js                                              â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 1: Parse Command-Line Arguments                                   â”‚  â”‚
â”‚  â”‚    - Use process.argv.slice(2)                                          â”‚  â”‚
â”‚  â”‚    - Extract: --owner, --payees, --shares, --cap                        â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 2: Validate Arguments                                             â”‚  â”‚
â”‚  â”‚    - All required params present                                        â”‚  â”‚
â”‚  â”‚    - Valid Ethereum addresses                                           â”‚  â”‚
â”‚  â”‚    - Payees count == shares count                                       â”‚  â”‚
â”‚  â”‚    - At least one payee                                                 â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 3: Parse & Convert                                                â”‚  â”‚
â”‚  â”‚    - Split payees: "0x...,0x..." â†’ [0x..., 0x...]                       â”‚  â”‚
â”‚  â”‚    - Split shares: "5000,5000" â†’ [5000, 5000]                           â”‚  â”‚
â”‚  â”‚    - Convert cap: "0.6" â†’ ethers.parseEther("0.6")                      â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 4: Get Contract Factory                                           â”‚  â”‚
â”‚  â”‚    const Splitter = await ethers.getContractFactory(                    â”‚  â”‚
â”‚  â”‚      "VeriFundSplitter"                                                 â”‚  â”‚
â”‚  â”‚    );                                                                   â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 5: Deploy Contract                                                â”‚  â”‚
â”‚  â”‚    const splitter = await Splitter.deploy(                              â”‚  â”‚
â”‚  â”‚      initialOwner,    // Project creator                                â”‚  â”‚
â”‚  â”‚      payeeAddresses,  // Investor wallets                               â”‚  â”‚
â”‚  â”‚      payeeShares,     // Basis points [5000, 3000, 2000]                â”‚  â”‚
â”‚  â”‚      repaymentCapWei  // Max payout in Wei                              â”‚  â”‚
â”‚  â”‚    );                                                                   â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 6: Wait for Deployment                                            â”‚  â”‚
â”‚  â”‚    await splitter.waitForDeployment();                                  â”‚  â”‚
â”‚  â”‚    const address = await splitter.getAddress();                         â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Step 7: Output Address (ONLY OUTPUT!)                                  â”‚  â”‚
â”‚  â”‚    console.log(address);  // 0x1234...                                  â”‚  â”‚
â”‚  â”‚    process.exit(0);                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ RPC Call to Sepolia
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 4: BLOCKCHAIN (Sepolia Testnet)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ VeriFundSplitter Contract                                                â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  constructor(                                                            â”‚  â”‚
â”‚  â”‚    address initialOwner,          // Project creator (Admin)            â”‚  â”‚
â”‚  â”‚    address payable[] _payees,     // Investor addresses                 â”‚  â”‚
â”‚  â”‚    uint256[] _shares,             // Share basis points                 â”‚  â”‚
â”‚  â”‚    uint256 _repaymentCap          // Max distribution in Wei            â”‚  â”‚
â”‚  â”‚  )                                                                       â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  State Variables:                                                        â”‚  â”‚
â”‚  â”‚    mapping(address => uint256) public shares;                           â”‚  â”‚
â”‚  â”‚    mapping(address => uint256) public released;                         â”‚  â”‚
â”‚  â”‚    uint256 public totalShares = 10000;                                  â”‚  â”‚
â”‚  â”‚    uint256 public totalReleased = 0;                                    â”‚  â”‚
â”‚  â”‚    uint256 public repaymentCap;                                         â”‚  â”‚
â”‚  â”‚    address payable[] public payees;                                     â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Security Features:                                                      â”‚  â”‚
â”‚  â”‚    âœ“ Ownable (creator controls)                                         â”‚  â”‚
â”‚  â”‚    âœ“ Pausable (emergency freeze)                                        â”‚  â”‚
â”‚  â”‚    âœ“ ReentrancyGuard (prevent reentrancy)                               â”‚  â”‚
â”‚  â”‚    âœ“ Pull-over-push withdrawal pattern                                  â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Key Functions:                                                          â”‚  â”‚
â”‚  â”‚    - receive() - Accept ETH payments                                    â”‚  â”‚
â”‚  â”‚    - release(address) - Investor withdraws their share                  â”‚  â”‚
â”‚  â”‚    - pendingPayment(address) - Check available amount                   â”‚  â”‚
â”‚  â”‚    - remainingCap() - Check remaining distribution limit                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  Contract Address: 0x1234567890123456789012345678901234567890                  â”‚
â”‚  Deployed Block: 5123456                                                       â”‚
â”‚  Network: Sepolia Testnet (Chain ID: 11155111)                                 â”‚
â”‚  View: https://sepolia.etherscan.io/address/0x...                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ Return to Backend
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 5: DATABASE (MongoDB)                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Project Document (UPDATED)                                               â”‚  â”‚
â”‚  â”‚  {                                                                       â”‚  â”‚
â”‚  â”‚    _id: ObjectId("673..."),                                              â”‚  â”‚
â”‚  â”‚    title: "Revolutionary AI Startup",                                   â”‚  â”‚
â”‚  â”‚    creator: ObjectId("672..."),                                          â”‚  â”‚
â”‚  â”‚    status: "Live",  â¬…ï¸ UPDATED from "Funding"                           â”‚  â”‚
â”‚  â”‚    fundingGoalInr: 100000,                                               â”‚  â”‚
â”‚  â”‚    currentFundingInr: 100000,                                            â”‚  â”‚
â”‚  â”‚    splitterContractAddress: "0x1234...",  â¬…ï¸ NEWLY SET                  â”‚  â”‚
â”‚  â”‚    investorCount: 2,                                                     â”‚  â”‚
â”‚  â”‚    investments: [                                                        â”‚  â”‚
â”‚  â”‚      { investor: ObjectId("673..."), amount: 60000 },                    â”‚  â”‚
â”‚  â”‚      { investor: ObjectId("674..."), amount: 40000 }                     â”‚  â”‚
â”‚  â”‚    ]                                                                     â”‚  â”‚
â”‚  â”‚  }                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Investment Documents                                                     â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Investment 1:                                                           â”‚  â”‚
â”‚  â”‚  {                                                                       â”‚  â”‚
â”‚  â”‚    _id: ObjectId("675..."),                                              â”‚  â”‚
â”‚  â”‚    investor: ObjectId("673..."),                                         â”‚  â”‚
â”‚  â”‚    project: ObjectId("673..."),                                          â”‚  â”‚
â”‚  â”‚    amountInr: 60000,                                                     â”‚  â”‚
â”‚  â”‚    sharePercent: 60,                                                     â”‚  â”‚
â”‚  â”‚    transactionHash: "0xabc...",                                          â”‚  â”‚
â”‚  â”‚    status: "Confirmed"                                                   â”‚  â”‚
â”‚  â”‚  }                                                                       â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  Investment 2:                                                           â”‚  â”‚
â”‚  â”‚  {                                                                       â”‚  â”‚
â”‚  â”‚    _id: ObjectId("676..."),                                              â”‚  â”‚
â”‚  â”‚    investor: ObjectId("674..."),                                         â”‚  â”‚
â”‚  â”‚    project: ObjectId("673..."),                                          â”‚  â”‚
â”‚  â”‚    amountInr: 40000,                                                     â”‚  â”‚
â”‚  â”‚    sharePercent: 40,                                                     â”‚  â”‚
â”‚  â”‚    transactionHash: "0xdef...",                                          â”‚  â”‚
â”‚  â”‚    status: "Confirmed"                                                   â”‚  â”‚
â”‚  â”‚  }                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ Response to Frontend
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FINAL RESPONSE                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                                                              â”‚
â”‚    "success": true,                                                             â”‚
â”‚    "message": "Investment successful! Funding goal reached and splitter         â”‚
â”‚                contract deployed.",                                             â”‚
â”‚    "investment": {                                                              â”‚
â”‚      "_id": "676...",                                                           â”‚
â”‚      "amountInr": 40000,                                                        â”‚
â”‚      "sharePercent": 40                                                         â”‚
â”‚    },                                                                           â”‚
â”‚    "project": {                                                                 â”‚
â”‚      "_id": "673...",                                                           â”‚
â”‚      "status": "Live",                                                          â”‚
â”‚      "currentFundingInr": 100000,                                               â”‚
â”‚      "fundingGoalInr": 100000,                                                  â”‚
â”‚      "splitterContractAddress": "0x1234567890123456789012345678901234567890"    â”‚
â”‚    },                                                                           â”‚
â”‚    "splitterDeployed": true,                                                    â”‚
â”‚    "splitterAddress": "0x1234567890123456789012345678901234567890"              â”‚
â”‚  }                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Revenue Distribution Flow (After Deployment)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REVENUE PAYOUT FLOW                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Project Generates Revenue
   â””â”€> Business receives payment from customers
       â””â”€> Revenue accumulates in project's business account

Step 2: Simulate Payout (For Testing)
   â””â”€> web3Service.simulatePayout(contractAddress, "0.1")
       â””â”€> Sends test ETH to splitter contract
           â””â”€> Contract emits PaymentReceived event

Step 3: Investor Checks Available Amount
   â””â”€> Call contract.pendingPayment(investorAddress)
       â””â”€> Returns: 0.06 ETH (60% share of 0.1 ETH)

Step 4: Investor Withdraws
   â””â”€> Investor calls contract.release(investorAddress)
       â”œâ”€> Calculate: totalReceived * shares[investor] / totalShares
       â”œâ”€> Subtract: released[investor] (already withdrawn)
       â”œâ”€> Clamp to: remainingCap (enforce 120% limit)
       â”œâ”€> Update: released[investor] += payment
       â”œâ”€> Update: totalReleased += payment
       â”œâ”€> Transfer: ETH to investor's wallet
       â””â”€> Emit: PaymentReleased(investor, amount)

Step 5: Track Progress
   â””â”€> Monitor: totalReleased vs repaymentCap
       â””â”€> When totalReleased >= repaymentCap:
           â””â”€> Emit CapReached(totalReleased)
           â””â”€> No further distributions allowed
```

---

## Component Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component               â”‚ Responsibility                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frontend                â”‚ - Collect investment amount from user      â”‚
â”‚                         â”‚ - Display funding progress                 â”‚
â”‚                         â”‚ - Show contract deployment status          â”‚
â”‚                         â”‚ - Link to Etherscan for verification       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ investment.controller   â”‚ - Handle HTTP requests                     â”‚
â”‚                         â”‚ - Extract JWT token                        â”‚
â”‚                         â”‚ - Validate request body                    â”‚
â”‚                         â”‚ - Format response                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ investment.service      â”‚ - Business logic for investments           â”‚
â”‚                         â”‚ - Update project funding metrics           â”‚
â”‚                         â”‚ - Detect funding goal completion           â”‚
â”‚                         â”‚ - Trigger contract deployment              â”‚
â”‚                         â”‚ - Handle deployment errors gracefully      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ web3.service            â”‚ - Interface to blockchain                  â”‚
â”‚                         â”‚ - Prepare deployment arguments             â”‚
â”‚                         â”‚ - Execute Hardhat script                   â”‚
â”‚                         â”‚ - Parse contract address                   â”‚
â”‚                         â”‚ - Simulate payouts for testing             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ deploy.js (Hardhat)     â”‚ - Parse CLI arguments                      â”‚
â”‚                         â”‚ - Validate Ethereum addresses              â”‚
â”‚                         â”‚ - Deploy VeriFundSplitter contract         â”‚
â”‚                         â”‚ - Output contract address to stdout        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VeriFundSplitter.sol    â”‚ - Store investor shares on-chain           â”‚
â”‚                         â”‚ - Accept revenue payments                  â”‚
â”‚                         â”‚ - Calculate proportional distributions     â”‚
â”‚                         â”‚ - Enforce repayment cap                    â”‚
â”‚                         â”‚ - Enable investor withdrawals              â”‚
â”‚                         â”‚ - Emit events for tracking                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MongoDB                 â”‚ - Store project metadata                   â”‚
â”‚                         â”‚ - Track investments                        â”‚
â”‚                         â”‚ - Save contract address                    â”‚
â”‚                         â”‚ - Update project status                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error Scenario               â”‚ Handling Strategy                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User has no wallet address   â”‚ - Deployment fails gracefully            â”‚
â”‚                              â”‚ - Investment still recorded              â”‚
â”‚                              â”‚ - Project stays in "Funding" status      â”‚
â”‚                              â”‚ - Admin can manually deploy later        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Insufficient deployer funds  â”‚ - Error caught in web3.service           â”‚
â”‚                              â”‚ - Clear error message returned           â”‚
â”‚                              â”‚ - Investment recorded                    â”‚
â”‚                              â”‚ - Manual deployment endpoint available   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Network timeout              â”‚ - Hardhat execution times out (120s)     â”‚
â”‚                              â”‚ - Deployment marked as failed            â”‚
â”‚                              â”‚ - Investment still saved                 â”‚
â”‚                              â”‚ - Retry mechanism available              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Invalid shares calculation   â”‚ - PREVENTED by adjustment logic          â”‚
â”‚                              â”‚ - Largest share adjusted to ensure       â”‚
â”‚                              â”‚   sum = exactly 10000                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Duplicate investor addresses â”‚ - PREVENTED by Map grouping              â”‚
â”‚                              â”‚ - Investments summed per unique wallet   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Contract deployment fails    â”‚ - Error logged with full context         â”‚
â”‚                              â”‚ - Response indicates deployment failed   â”‚
â”‚                              â”‚ - Project can be manually deployed       â”‚
â”‚                              â”‚ - Investment data preserved              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Measures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer                 â”‚ Security Measure                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API                   â”‚ - JWT authentication required                  â”‚
â”‚                       â”‚ - Role-based access control                    â”‚
â”‚                       â”‚ - Input validation                             â”‚
â”‚                       â”‚ - Rate limiting (recommended)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Business Logic        â”‚ - Prevent creator self-investment              â”‚
â”‚                       â”‚ - Validate funding doesn't exceed goal         â”‚
â”‚                       â”‚ - Check project status before accepting        â”‚
â”‚                       â”‚ - Atomic database operations                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web3 Service          â”‚ - Address validation (ethers.isAddress)        â”‚
â”‚                       â”‚ - Share calculation verification               â”‚
â”‚                       â”‚ - Command injection prevention                 â”‚
â”‚                       â”‚ - Timeout protection                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Smart Contract        â”‚ - Ownable (creator controls)                   â”‚
â”‚                       â”‚ - Pausable (emergency freeze)                  â”‚
â”‚                       â”‚ - ReentrancyGuard                              â”‚
â”‚                       â”‚ - Pull-over-push withdrawal                    â”‚
â”‚                       â”‚ - Checks-Effects-Interactions pattern          â”‚
â”‚                       â”‚ - Repayment cap enforcement                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation                     â”‚ Time         â”‚ Notes                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Investment API call           â”‚ 50-200ms     â”‚ Database write           â”‚
â”‚ Funding goal check            â”‚ < 1ms        â”‚ In-memory calculation    â”‚
â”‚ Fetch investments (populate)  â”‚ 10-50ms      â”‚ MongoDB query with join  â”‚
â”‚ Share calculation             â”‚ < 1ms        â”‚ Array operations         â”‚
â”‚ Hardhat script execution      â”‚ 20-60s       â”‚ Network-dependent        â”‚
â”‚ Contract deployment           â”‚ 15-45s       â”‚ Sepolia block time       â”‚
â”‚ Database update (address)     â”‚ 10-30ms      â”‚ Single document update   â”‚
â”‚ Total (goal-reaching invest)  â”‚ 30-90s       â”‚ Most time in deployment  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monitoring & Logging

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Log Point                      â”‚ Information Captured                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Investment received            â”‚ - Amount, investor ID, project ID     â”‚
â”‚ Funding goal reached           â”‚ - Project title, total raised         â”‚
â”‚ Deployment started             â”‚ - Investor count, shares array        â”‚
â”‚ Hardhat command constructed    â”‚ - Full command with arguments         â”‚
â”‚ Deployment in progress         â”‚ - Status updates                      â”‚
â”‚ Contract deployed              â”‚ - Contract address, block number      â”‚
â”‚ Deployment failed              â”‚ - Error message, stack trace          â”‚
â”‚ Project status updated         â”‚ - Old status â†’ new status             â”‚
â”‚ Database saved                 â”‚ - Project ID, contract address        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Example Log Output:**
```
Investment added to project: â‚¹60000 by investor 673abc...
Project funding: â‚¹100000 / â‚¹100000
Funding check: isFunded=true, hasNoSplitter=true
ğŸ‰ Funding goal reached! Deploying splitter contract...

ğŸš€ Starting smart contract deployment for project: Revolutionary AI Startup
ğŸ“Š Total investments: 2
ğŸ’° Total raised: â‚¹100000
ğŸ‘¥ Unique investors: 2
ğŸ“ˆ Shares (basis points): [ 6000, 4000 ]
âœ“ Shares sum: 10000 (must be 10000)
ğŸ¯ Repayment cap: â‚¹120000 (~0.6000 ETH)

ğŸ“ Executing deployment command...
   Owner: 0x1234567890123456789012345678901234567890
   Payees: 2
   Network: Sepolia

âœ… Contract deployed successfully!
ğŸ“ Contract address: 0xabcdefabcdefabcdefabcdefabcdefabcdefabcd
ğŸ”— View on Etherscan: https://sepolia.etherscan.io/address/0xabcdef...
```

---

## Data Flow Summary

```
Investment Request
   â†“
Validate & Save Investment
   â†“
Update Project Funding
   â†“
Check: Funding Goal Reached?
   â”œâ”€ No â†’ Return success (normal investment)
   â””â”€ Yes â†’ Continue to deployment
       â†“
   Fetch All Investments (populate investor wallets)
       â†“
   Calculate Shares (basis points)
       â†“
   Build Hardhat Command
       â†“
   Execute Deploy Script
       â†“
   Parse Contract Address
       â†“
   Save to Project Document
       â†“
   Update Status to "Live"
       â†“
   Return Success + Contract Address
```

---

**Architecture Version**: 1.0  
**Last Updated**: October 14, 2025  
**Status**: âœ… Fully Implemented & Tested
